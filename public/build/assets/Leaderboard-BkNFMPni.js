import{r as d,j as e,a as v}from"./app-CB6H9fcf.js";import{D as k}from"./DuoLayout-1S1Fd3QP.js";import{R as M}from"./RightCourseSidebar-QTU9qcSS.js";import{P as L}from"./Toast-BdGrl3Cx.js";const S=({scope:s,setScope:t})=>e.jsx("div",{className:"mb-4 flex gap-2 rounded-lg bg-gray-100 p-1 text-sm",children:["week","all"].map(a=>e.jsx("button",{onClick:()=>t(a),className:`rounded-md px-3 py-1 font-semibold ${s===a?"bg-white shadow text-gray-900":"text-gray-500 hover:text-gray-700"}`,children:a==="week"?"This Week":"All Time"},a))}),g=[{name:"Bronze",min:0,color:"bg-amber-200 text-amber-800",chip:"bg-amber-100 text-amber-700",emoji:"🥉"},{name:"Silver",min:100,color:"bg-gray-200 text-gray-800",chip:"bg-gray-100 text-gray-700",emoji:"🥈"},{name:"Gold",min:200,color:"bg-yellow-200 text-yellow-800",chip:"bg-yellow-100 text-yellow-700",emoji:"🥇"},{name:"Sapphire",min:400,color:"bg-blue-200 text-blue-800",chip:"bg-blue-100 text-blue-700",emoji:"🔷"},{name:"Ruby",min:700,color:"bg-red-200 text-red-800",chip:"bg-red-100 text-red-700",emoji:"🔴"},{name:"Emerald",min:1e3,color:"bg-green-200 text-green-800",chip:"bg-green-100 text-green-700",emoji:"🟢"}],h=s=>{let t=g[0];for(const i of g)if(s>=i.min)t=i;else break;const a=g.findIndex(i=>i.name===t.name),m=g[a+1]||null;return{...t,nextMin:m?.min??null,nextName:m?.name??null}},C=({pos:s})=>{const t={1:"🥇",2:"🥈",3:"🥉"};return t[s]?e.jsx("span",{className:"absolute -right-1 -top-1 select-none",title:"Top placement",children:t[s]}):null},P=({name:s,pos:t})=>{const a=(s||"U").charAt(0).toUpperCase();return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-200 text-sm font-bold text-gray-600 ring-2 ring-white",children:a}),e.jsx(C,{pos:t})]})},E=({pos:s,name:t,xp:a,you:m,scope:i})=>{const u=i==="week"?h(a):null;return e.jsxs("div",{className:`flex items-center justify-between rounded-xl border p-3 ${m?"border-blue-300 bg-blue-50":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-100 text-sm font-bold text-gray-700 ring-1 ring-gray-200",children:s}),e.jsx(P,{name:t,pos:s}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-gray-800",children:t}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:m?"You":"Learner"}),u&&e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 ${u.chip}`,children:[e.jsx("span",{"aria-hidden":!0,children:u.emoji}),e.jsx("span",{children:u.name})]})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:[a," XP"]})})]})};function Y({auth:s}){const[t,a]=d.useState("week"),[m,i]=d.useState(!0),[u,p]=d.useState(""),[b,f]=d.useState([]),[n,N]=d.useState({xp:0,rank:0}),[c,j]=d.useState(null),o=d.useMemo(()=>{if(t!=="week")return null;if(c?.current?.tier?.name){const r=c.current.tier.name,l=h(n?.xp||0),x=g.find(w=>w.name.toLowerCase()===r.toLowerCase());return x?{...x,nextMin:h(n?.xp||0).nextMin,nextName:h(n?.xp||0).nextName}:l}return h(n?.xp||0)},[n,t,c]),y=async r=>{try{i(!0),p("");const l=await v.get(`/leaderboard?scope=${r}`),x=l?.data?.data||l?.data||l;f(Array.isArray(x?.top)?x.top:[]),N(x?.you||{xp:0,rank:0})}catch{p("Failed to load leaderboard")}finally{i(!1)}};return d.useEffect(()=>{y(t)},[t]),d.useEffect(()=>{let r=!0;return(async()=>{try{const l=await L.getMyLeague?.(),x=l?.data?.data||l?.data||l;r&&j(x||null)}catch{r&&j({error:!0})}})(),()=>{r=!1}},[]),e.jsx(k,{right:e.jsx(M,{course:null,hearts:s?.user?.hearts,points:s?.user?.points??s?.user?.xp,otherCourses:s?.user?.courses||[]}),centerMaxClass:"xl:max-w-2xl",children:e.jsxs("div",{className:"w-full p-6",children:[e.jsx("h1",{className:"mb-1 text-2xl font-bold",children:"Leaderboard"}),e.jsx("p",{className:"mb-4 text-sm text-gray-500",children:"Compete with others and climb the ranks."}),t==="week"&&e.jsxs("div",{className:"mb-4 rounded-2xl border border-gray-200 bg-white p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-full text-lg font-bold ${o?.color||"bg-gray-200 text-gray-700"}`,children:e.jsx("span",{"aria-hidden":!0,children:o?.emoji||"🏆"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800",children:"Your League"}),e.jsx("div",{className:"text-xs text-gray-500",children:c?.current?.tier?.name||o?.name||"Unranked"})]})]}),e.jsxs("div",{className:"text-right text-sm font-semibold text-gray-800",children:[c?.this_week?.xp??n?.xp??0," XP this week"]})]}),c?.error&&e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Leagues initializing…"}),o?.nextMin!=null&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Progress to ",o.nextName]}),e.jsxs("span",{children:[Math.max(0,o.nextMin-((c?.this_week?.xp??n?.xp)||0))," XP left"]})]}),e.jsx("div",{className:"mt-1 h-2 w-full rounded bg-gray-200",children:e.jsx("div",{className:"h-2 rounded bg-blue-500",style:{width:`${Math.min(100,Math.round((((c?.this_week?.xp??n?.xp)||0)-o.min)/Math.max(1,o.nextMin-o.min)*100))}%`}})})]})]}),e.jsx(S,{scope:t,setScope:a}),m?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(r=>e.jsx("div",{className:"h-14 rounded-xl bg-gray-100 animate-pulse"},r))}):u?e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:[e.jsx("span",{children:u}),e.jsx("button",{onClick:()=>y(t),className:"rounded border px-2 py-1 text-xs text-red-700 hover:bg-red-100",children:"Retry"})]}):e.jsxs("div",{className:"space-y-2",children:[b.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No entries yet."}):b.map(r=>e.jsx(E,{pos:r.position,name:r.name,xp:r.xp,you:r.is_you,scope:t},r.user_id)),e.jsx("div",{className:"mt-4 rounded-xl border border-gray-200 bg-white p-3 text-sm text-gray-700",children:t==="all"?e.jsxs(e.Fragment,{children:["Your all time position: ",e.jsx("span",{className:"font-semibold",children:n.rank||"-"})]}):e.jsxs(e.Fragment,{children:["Your weekly position: ",e.jsx("span",{className:"font-semibold",children:n.rank||"-"})," / ",e.jsxs("span",{className:"font-semibold",children:[n.xp," XP"]})]})})]})]})})}export{Y as default};
