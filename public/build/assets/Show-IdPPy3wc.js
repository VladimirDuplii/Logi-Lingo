import{r as c,j as e,H as he}from"./app-CB6H9fcf.js";import{C as q,D as ue}from"./DuoLayout-1S1Fd3QP.js";import"./card-Cn0cBMnd.js";import"./button-2bCJMJSP.js";import"./Skeleton-C7VVEt2j.js";import{P as fe}from"./ProgressBar-BOgo5wNz.js";import{P as B,u as ge}from"./Toast-BdGrl3Cx.js";import{m as H}from"./proxy-B5i_yUx8.js";import{R as pe}from"./RightCourseSidebar-QTU9qcSS.js";const be={purple:"violet",blue:"sky",teal:"teal"};function ye(t){return c.useMemo(()=>be[t]||t||"brand",[t])}const te={brand:{grad:"from-brand-500 to-brand-600",bar:"bg-brand-500",track:"bg-brand-200",path:"bg-brand-500",nodeBg:"bg-white",nodeBorder:"border-brand-200",hover:"hover:border-brand-300"},violet:{grad:"from-violet-500 to-fuchsia-600",bar:"bg-violet-500",track:"bg-violet-200",path:"bg-violet-500",nodeBg:"bg-white",nodeBorder:"border-violet-200",hover:"hover:border-violet-300"},sky:{grad:"from-sky-500 to-blue-600",bar:"bg-sky-500",track:"bg-sky-200",path:"bg-sky-500",nodeBg:"bg-white",nodeBorder:"border-sky-200",hover:"hover:border-sky-300"},teal:{grad:"from-teal-500 to-emerald-600",bar:"bg-teal-500",track:"bg-teal-200",path:"bg-teal-500",nodeBg:"bg-white",nodeBorder:"border-teal-200",hover:"hover:border-teal-300"},emerald:{grad:"from-accent-500 to-accent-600",bar:"bg-accent-500",track:"bg-accent-500/20",path:"bg-accent-500",nodeBg:"bg-white",nodeBorder:"border-accent-500/40",hover:"hover:border-accent-500"}};function je({units:t=[],onLessonSelect:s}){const[n,l]=c.useState(null),r=t||[];return e.jsxs("div",{className:"ui-card-clean p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("span",{className:"text-2xl",children:"🚀"}),e.jsx("h3",{className:"text-xl md:text-2xl font-semibold tracking-tight text-gray-800",children:"Навчальний шлях"})]}),e.jsx("div",{className:"space-y-16",children:r.map((o,i)=>{const m=ye(o.theme),d=te[m]||te.brand,a=o.lessons||[],x=a.filter(u=>u.completed).length,h=a.length?Math.round(x/a.length*100):0;return e.jsxs("div",{className:"relative",children:[i>0&&e.jsx("div",{className:"absolute left-8 -top-12 w-1 h-12 bg-gradient-to-b from-transparent to-gray-200"}),e.jsxs("div",{className:"flex items-center gap-5 mb-6",children:[e.jsx("div",{className:`w-16 h-16 rounded-xl flex items-center justify-center text-2xl shadow-sm transition-transform duration-300 hover:scale-105 ${o.unlocked?`bg-gradient-to-br ${d.grad} text-white`:"bg-gray-200 text-gray-500"}`,children:o.icon||"📦"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`text-lg md:text-xl font-semibold ${o.unlocked?"text-gray-800":"text-gray-400"}`,children:o.title}),o.unlocked&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 text-xs text-gray-500",children:[e.jsxs("span",{children:[x," з ",a.length," завершено"]}),e.jsxs("span",{className:`font-medium ${d.bar.replace("bg-","text-")}`,children:[h,"%"]})]}),e.jsx(fe,{value:h,height:"h-1.5",trackClass:d.track,fillClass:d.bar})]})]}),!o.unlocked&&e.jsx("div",{className:"ml-auto text-gray-400",title:"Locked",children:"🔒"})]}),e.jsxs("div",{className:`ml-4 md:ml-8 pl-4 md:pl-8 relative ${o.unlocked?"":"opacity-50"} group`,children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${d.path} rounded-full transition-colors duration-300 group-hover:brightness-110`}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:a.map((u,y)=>{const L=`${i}-${y}`,f=o.unlocked,k=u.completed?`border-${d.nodeBorder?.replace("border-","")} shadow-sm ${n===L?"transform scale-105 shadow-md":""} cursor-pointer bg-white`:`${d.nodeBg} ${d.nodeBorder} ${d.hover} hover:shadow-md ${f?"cursor-pointer":"cursor-not-allowed opacity-60"}`;return e.jsxs("div",{onMouseEnter:()=>l(L),onMouseLeave:()=>l(null),onClick:()=>f&&s&&s(u,o),className:`p-5 rounded-xl border-2 transition-all duration-300 relative ${k}`,children:[e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:`text-3xl ${u.completed?"animate-bounce-small":""}`,children:u.character||"📘"}),e.jsx("div",{className:"font-semibold text-gray-800 mt-1 line-clamp-2 text-sm",children:u.name}),u.completed&&e.jsx("div",{className:"flex mt-1",children:[...Array(u.stars||0)].map((A,M)=>e.jsx("span",{className:"text-yellow-400",children:"⭐"},M))})]}),u.completed&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 rounded-full p-1 shadow-md",title:"Completed",children:"✅"})]},L)})})]})]},i)})})]})}const se="absolute left-1/2 -translate-x-1/2 w-0.5 bg-green-300",ve=({lesson:t,index:s,total:n,onClick:l})=>{const r=s%2===0,o=s===n-1;return e.jsxs("div",{className:`relative flex items-center ${r?"justify-start":"justify-end"} min-h-[90px]`,children:[s>0&&e.jsx("div",{className:`${se}`,style:{top:0,height:"40px"}}),e.jsx("button",{onClick:l,className:`relative z-10 inline-flex h-14 w-14 items-center justify-center rounded-full border-2 ${r?"ml-2":"mr-2"} border-green-400 bg-white text-lg font-bold text-green-700 shadow-md hover:shadow-lg hover:scale-105 transition`,"aria-label":`Open lesson ${t.title||t.order}`,children:t.order}),!o&&e.jsx("div",{className:`${se}`,style:{bottom:0,height:"40px"}})]})},we=({courseId:t,units:s,onUnitSelect:n,onLessonSelect:l})=>{const[r,o]=c.useState(()=>new Set);if(!s||s.length===0)return e.jsx("div",{className:"text-gray-600",children:"No units available for this course."});const i=a=>{o(x=>{const h=new Set(x);return h.has(a)?h.delete(a):h.add(a),h})},m=async a=>{try{await B.trackUnitView(t,a.id)}catch{}i(a.id),n&&n(a)},d=async(a,x)=>{try{await B.trackLessonStart(t,a.id,x.id)}catch{}n&&n(a),l&&l(x,a)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"mb-2 text-xl font-semibold text-gray-800",children:"Розділи курсу"}),s.map(a=>e.jsxs("div",{className:"overflow-hidden rounded-2xl ring-1 ring-gray-100 bg-white shadow-sm",children:[e.jsxs("button",{className:"flex w-full items-center justify-between gap-4 px-5 py-4 text-left hover:bg-green-50",onClick:()=>m(a),"aria-expanded":r.has(a.id),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-green-400 to-green-500 text-white font-bold shadow-inner",children:a.order}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description})]})]}),e.jsxs("div",{className:"shrink-0 text-sm text-gray-600",children:[a.lessons_count," уроків"]})]}),e.jsx("div",{className:`px-5 pb-5 ${r.has(a.id)?"block":"hidden"}`,children:Array.isArray(a.lessons)&&a.lessons.length>0?e.jsxs("div",{className:"relative mx-auto max-w-xl",children:[e.jsx("div",{className:"absolute left-1/2 top-0 h-full w-0.5 -translate-x-1/2 bg-green-200"}),e.jsx("div",{className:"relative grid grid-cols-1 gap-3",children:a.lessons.map((x,h)=>e.jsx(ve,{lesson:x,index:h,total:a.lessons.length,onClick:()=>d(a,x)},x.id))})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Немає уроків у цьому розділі."})})]},a.id))]})},Ne=({courseId:t,initialCourse:s,onUnitSelect:n,onLessonSelect:l})=>{const[r,o]=c.useState(s||null),[i,m]=c.useState(!0),[d,a]=c.useState(null),[x,h]=c.useState(!1);return c.useEffect(()=>{(async()=>{if(s){m(!1);return}if(t)try{const y=await q.getCourseById(t);console.log("Course API response:",y);const L=y.data&&y.data.data?y.data.data:y.data;o(L)}catch(y){a("Failed to load course details. Please try again later."),console.error("Error fetching course details:",y)}finally{m(!1)}})()},[t,s]),i?e.jsx("div",{className:"loading",children:"Loading course details..."}):d?e.jsx("div",{className:"error-message",children:d}):r?e.jsxs("div",{className:"course-detail",children:[e.jsxs("div",{className:"course-header",children:[e.jsx("h1",{children:r.title}),e.jsx("p",{className:"course-description",children:r.description}),e.jsxs("div",{className:"course-meta",children:[e.jsxs("span",{className:"course-level",children:["Level: ",r.level]}),e.jsxs("span",{className:"course-units-count",children:["Units: ",r.units_count]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{className:"inline-flex items-center justify-center rounded-full bg-green-500 px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",onClick:()=>{if(!r?.units?.length)return;h(!0);const u=r.units.find(y=>Array.isArray(y.lessons)&&y.lessons.length>0)||r.units[0];n&&n(u),h(!1)},disabled:x||!r?.units?.length,children:"Почати навчання"}),!r?.units?.some(u=>Array.isArray(u.lessons)&&u.lessons.length>0)&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"У першого розділу немає уроків. Оберіть інший розділ нижче."})]})]}),e.jsx(we,{courseId:t,onUnitSelect:n,onLessonSelect:l,units:r.units||[]})]}):e.jsx("div",{className:"no-course",children:"Course not found."})},Ce=({courseId:t,unitId:s,onLessonSelect:n})=>{const[l,r]=c.useState([]),[o,i]=c.useState(!0),[m,d]=c.useState(null);c.useEffect(()=>{(async()=>{if(!(!t||!s))try{const h=await q.getLessons(t,s);console.log("Lessons API response:",h);const u=Array.isArray(h.data)?h.data:h.data.data||[];r(u)}catch(h){d("Failed to load lessons. Please try again later."),console.error("Error fetching lessons:",h)}finally{i(!1)}})()},[t,s]);const a=async x=>{try{await B.trackLessonStart(t,s,x.id)}catch(h){console.error("Error tracking lesson start:",h)}n&&n(x)};return o?e.jsx("div",{className:"loading",children:"Loading lessons..."}):m?e.jsx("div",{className:"error-message",children:m}):l.length===0?e.jsx("div",{className:"no-lessons",children:"No lessons available for this unit."}):e.jsxs("div",{className:"lesson-list",children:[e.jsx("h2",{children:"Unit Lessons"}),e.jsx("div",{className:"lessons",children:l.map(x=>e.jsxs("div",{className:"lesson-item",onClick:()=>a(x),children:[e.jsx("div",{className:"lesson-number",children:x.order}),e.jsxs("div",{className:"lesson-content",children:[e.jsx("h3",{children:x.title}),e.jsx("p",{children:x.description}),e.jsx("div",{className:"lesson-meta",children:e.jsxs("span",{className:"question-count",children:[x.questions_count||0," questions"]})})]})]},x.id))})]})},ke=({className:t=""})=>e.jsx("svg",{viewBox:"0 0 24 24",className:t,"aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M12 2l2.9 6.2 6.8.6-5.1 4.4 1.6 6.6L12 16.8 5.8 19.8l1.6-6.6L2.3 8.8l6.8-.6L12 2z"})}),Le=({className:t=""})=>e.jsx("svg",{viewBox:"0 0 24 24",className:t,"aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M4 3h12a3 3 0 0 1 3 3v12a1 1 0 0 1-1.4.9L16 18.6l-1.6.7A3 3 0 0 1 12 20H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm0 2v13h8a1 1 0 0 0 .4-.1L16 17V5H4z"})}),Se=({className:t=""})=>e.jsx("svg",{viewBox:"0 0 24 24",className:t,"aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M4 10h3v4H4v-4zm13 0h3v4h-3v-4zM8 9h8v6H8V9z"})}),Ee=({className:t=""})=>e.jsx("svg",{viewBox:"0 0 24 24",className:t,"aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M18 2h-2V1a1 1 0 1 0-2 0v1H10V1a1 1 0 1 0-2 0v1H6a1 1 0 0 0-1 1v2a4 4 0 0 0 3 3.86A6 6 0 0 0 11 14v2H7a1 1 0 1 0 0 2h10a1 1 0 1 0 0-2h-4v-2a6 6 0 0 0 3-5.14A4 4 0 0 0 19 5V3a1 1 0 0 0-1-1zm-11 3V4h1v2a6 6 0 0 0 .08.99A2 2 0 0 1 7 5zm11 0a2 2 0 0 1-1.08 1.74A6 6 0 0 0 15 6V4h3v1z"})}),Ae=({className:t=""})=>e.jsx("svg",{viewBox:"0 0 24 24",className:t,"aria-hidden":!0,children:e.jsx("path",{fill:"currentColor",d:"M3 8h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8zm2-4h14a2 2 0 0 1 2 2v2H3V6a2 2 0 0 1 2-2zm3 6h2v4H8v-4zm6 0h2v4h-2v-4z"})}),Me=({className:t=""})=>e.jsx("svg",{viewBox:"0 0 24 24",className:t,"aria-hidden":!0,children:e.jsx("path",{fill:"currentColor",d:"M7 10V7a5 5 0 0 1 10 0v3h1a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1v-9a1 1 0 0 1 1-1h1zm2 0h6V7a3 3 0 0 0-6 0v3z"})}),$e=({type:t,status:s})=>{const n="h-12 w-12 drop-shadow-[0_1px_0_rgba(0,0,0,0.1)]",l=s==="COMPLETE"?"text-yellow-500":s==="ACTIVE"?"text-white":"text-gray-400";switch(t){case"star":return e.jsx(ke,{className:`${n} ${l}`});case"book":return e.jsx(Le,{className:`${n} ${l}`});case"dumbbell":return e.jsx(Se,{className:`${n} ${l}`});case"trophy":return e.jsx(Ee,{className:`${n} ${l}`});case"treasure":return e.jsx(Ae,{className:`${n} ${l}`});default:return e.jsx(Me,{className:`${n} ${l}`})}},Te=(t,s,n=4)=>{const l=Math.floor(s/n);return t<l?"COMPLETE":t>l?"LOCKED":"ACTIVE"},Pe=t=>(t||[]).map(s=>({id:s.id,title:s.title,order:s.order,unitNumber:s.order||s.id,description:s.description||s.title||"Unit",backgroundColor:"bg-[#58cc02]",textColor:"text-[#58cc02]",borderColor:"border-[#46a302]",lessons:s.lessons||[],tiles:(s.lessons||[]).map(n=>({type:"star",description:n.title||`Lesson ${n.order}`,lesson:n}))})),Z=["left-0","left-[-45px]","left-[-70px]","left-[-45px]","left-0","left-[45px]","left-[70px]","left-[45px]"],_e=({index:t,unitNumber:s,tilesLength:n})=>{if(t>=n-1)return"left-0";const l=s%2===1?Z:[...Z.slice(4),...Z.slice(0,4)];return l[t%l.length]??"left-0"},Be=({unitNumber:t,description:s,backgroundColor:n="bg-[#58cc02]",borderColor:l="border-[#46a302]"})=>e.jsx("article",{className:["w-full text-white sm:rounded-xl",n].join(" "),children:e.jsxs("header",{className:"flex items-center justify-between gap-4 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Unit ",t]}),e.jsx("p",{className:"text-lg",children:s})]}),e.jsx("a",{href:"#",className:["flex items-center gap-3 rounded-2xl border-2 border-b-4 p-3 transition hover:text-gray-100",l].join(" "),children:e.jsx("span",{className:"font-bold uppercase",children:"Guidebook"})})]})}),De=({unit:t,onStartLesson:s,completedCount:n,prevUnitCompleted:l=!0})=>{const[r,o]=c.useState(null);return c.useEffect(()=>{const i=()=>o(null);return window.addEventListener("scroll",i),window.addEventListener("click",i),()=>{window.removeEventListener("scroll",i),window.removeEventListener("click",i)}},[]),e.jsxs(e.Fragment,{children:[e.jsx(Be,{unitNumber:t.unitNumber,description:t.description,backgroundColor:t.backgroundColor,borderColor:t.borderColor}),e.jsx("div",{className:"relative mb-8 mt-[67px] flex max-w-2xl flex-col items-center gap-4",children:t.tiles.map((i,m)=>{let a=Te(m,n,1);return m===0&&!l&&(a="LOCKED"),e.jsxs(c.Fragment,{children:[e.jsxs("div",{className:["relative -mb-4 h-[93px] w-[98px]",_e({index:m,unitNumber:t.unitNumber,tilesLength:t.tiles.length})].join(" "),children:[r!==m&&a==="ACTIVE"&&e.jsx(Ie,{text:"Start",textColor:t.textColor}),e.jsx(Ve,{segmentsTotal:(()=>{const x=i.lesson?.segments?.total;return Number.isFinite(x)&&x>0?x:4})(),segmentsFilled:(()=>{const x=i.lesson?.segments?.filled,h=i.lesson?.segments?.total;if(Number.isFinite(x)&&Number.isFinite(h))return Math.max(0,Math.min(x,h));const u=i.lesson,y=u?.progress?.completed_challenges??0,L=u?.progress?.total_challenges??0;if(!L)return 0;const f=Math.max(0,Math.min(1,y/L));return Math.max(0,Math.min(4,Math.floor(f*4)))})(),status:a}),e.jsxs("button",{className:["absolute m-3 rounded-full border-b-8 p-4",ze({tileType:i.type,status:a,defaultColors:`${t.borderColor} ${t.backgroundColor}`})].join(" "),onClick:()=>{a!=="LOCKED"&&(o(m),i.lesson&&a!=="LOCKED"&&s(i.lesson,t))},children:[e.jsx($e,{type:i.type,status:a}),e.jsx("span",{className:"sr-only",children:"Show lesson"})]})]}),e.jsx(Fe,{selectedTile:r,index:m,unitNumber:t.unitNumber,tilesLength:t.tiles.length,description:i.description,status:a,onClose:()=>o(null),onStartLesson:()=>{i.lesson&&a!=="LOCKED"&&s(i.lesson,t)}})]},m)})})]})},ze=({tileType:t,status:s,defaultColors:n})=>{switch(s){case"LOCKED":return t==="fast-forward"?n:"border-[#b7b7b7] bg-[#e5e5e5]";case"COMPLETE":return"border-yellow-500 bg-yellow-400";case"ACTIVE":return n}},Ie=({text:t,textColor:s})=>{const n=c.useRef(null),[l,r]=c.useState(72);return c.useEffect(()=>{r(n.current?.clientWidth??l)},[n.current?.clientWidth,l]),e.jsxs("div",{className:`absolute z-10 w-max animate-bounce rounded-lg border-2 border-gray-200 bg-white px-3 py-2 font-bold uppercase ${s}`,style:{top:"-25%",left:`calc(50% - ${l/2}px)`},ref:n,children:[t,e.jsx("div",{className:"absolute h-3 w-3 rotate-45 border-b-2 border-r-2 border-gray-200 bg-white",style:{left:"calc(50% - 8px)",bottom:"-8px"}})]})},Ve=({segmentsTotal:t=4,segmentsFilled:s=0,status:n})=>{if(n!=="ACTIVE")return null;switch(s){case 0:return e.jsx(He,{});case 1:return e.jsx(Re,{});case 2:return e.jsx(Ue,{});case 3:return e.jsx(Oe,{});default:return null}},He=()=>e.jsxs("svg",{viewBox:"0 0 100 100",style:{transitionDuration:"400ms"},className:"absolute h-[93px] w-[98px]",children:[e.jsx("defs",{children:e.jsx("clipPath",{id:"clip-session/ProgressRing1",children:e.jsx("path",{d:"M3.061616997868383e-15,-50L2.5717582782094417e-15,-42Z"})})}),e.jsx("g",{transform:"translate(50, 50)",children:e.jsx("path",{d:"M3.061616997868383e-15,-50L2.5717582782094417e-15,-42Z",fill:"rgb(255,200,0)"})})]}),Re=()=>e.jsxs("svg",{viewBox:"0 0 100 100",style:{transitionDuration:"400ms"},className:"absolute h-[93px] w-[98px]",children:[e.jsx("defs",{children:e.jsx("clipPath",{id:"clip-session/ProgressRing614",children:e.jsx("path",{d:"M3.061616997868383e-15,-50A50,50 0 0,1 35.35533905932738,-35.35533905932737L29.69846310392954,-29.69846310392954A42,42 0 0,0 2.5717582782094417e-15,-42Z"})})}),e.jsx("g",{transform:"translate(50, 50)",children:e.jsx("path",{d:"M3.061616997868383e-15,-50A50,50 0 0,1 35.35533905932738,-35.35533905932737L29.69846310392954,-29.69846310392954A42,42 0 0,0 2.5717582782094417e-15,-42Z",fill:"rgb(255,200,0)"})})]}),Ue=()=>e.jsxs("svg",{viewBox:"0 0 100 100",style:{transitionDuration:"400ms"},className:"absolute h-[93px] w-[98px]",children:[e.jsx("defs",{children:e.jsx("clipPath",{id:"clip-session/ProgressRing1043",children:e.jsx("path",{d:"M3.061616997868383e-15,-50A50,50 0 0,1 50,6.123233995736766e-15L42,5.1432506368746615e-15A42,42 0 0,0 2.5717582782094417e-15,-42Z"})})}),e.jsx("g",{transform:"translate(50, 50)",children:e.jsx("path",{d:"M3.061616997868383e-15,-50A50,50 0 0,1 50,6.123233995736766e-15L42,5.1432506368746615e-15A42,42 0 0,0 2.5717582782094417e-15,-42Z",fill:"rgb(255,200,0)"})})]}),Oe=()=>e.jsxs("svg",{viewBox:"0 0 100 100",style:{transitionDuration:"400ms"},className:"absolute h-[93px] w-[98px]",children:[e.jsx("defs",{children:e.jsx("clipPath",{id:"clip-session/ProgressRing1577",children:e.jsx("path",{d:"M3.061616997868383e-15,-50A50,50 0 0,1 35.35533905932738,35.35533905932738L29.69846310392954,29.69846310392954A42,42 0 0,0 2.5717582782094417e-15,-42Z"})})}),e.jsx("g",{transform:"translate(50, 50)",children:e.jsx("path",{d:"M3.061616997868383e-15,-50A50,50 0 0,1 35.35533905932738,35.35533905932738L29.69846310392954,29.69846310392954A42,42 0 0,0 2.5717582782094417e-15,-42Z",fill:"rgb(255,200,0)"})})]}),Fe=({selectedTile:t,index:s,unitNumber:n,tilesLength:l,description:r,status:o,onClose:i,onStartLesson:m})=>{const d=c.useRef(null);c.useEffect(()=>{const h=u=>{t!==s||d.current?.contains(u.target)||i()};return window.addEventListener("click",h,!0),()=>window.removeEventListener("click",h,!0)},[t,s,i]);const a="bg-green-500";return e.jsx("div",{className:["relative h-0 w-full",s===t?"":"invisible"].join(" "),ref:d,children:e.jsxs("div",{className:["absolute z-30 flex w-[300px] flex-col gap-4 rounded-xl p-4 font-bold transition-all duration-300",o==="ACTIVE"?a:o==="LOCKED"?"border-2 border-gray-200 bg-gray-100":"bg-yellow-400",s===t?"top-4 scale-100":"-top-14 scale-0"].join(" "),style:{left:"calc(50% - 150px)"},children:[e.jsx("div",{className:["absolute left-[140px] top-[-8px] h-4 w-4 rotate-45",o==="ACTIVE"?a:o==="LOCKED"?"border-l-2 border-t-2 border-gray-200 bg-gray-100":"bg-yellow-400"].join(" "),style:{left:Ke({index:s,unitNumber:n,tilesLength:l})}}),e.jsx("div",{className:["text-lg",o==="ACTIVE"?"text-white":o==="LOCKED"?"text-gray-400":"text-yellow-600"].join(" "),children:r}),o==="ACTIVE"?e.jsx("button",{onClick:m,className:["flex w-full items-center justify-center rounded-xl border-b-4 border-gray-200 bg-white p-3 uppercase","text-green-500"].join(" "),children:"Start +10 XP"}):o==="LOCKED"?e.jsx("button",{className:"w-full rounded-xl bg-gray-200 p-3 uppercase text-gray-400",disabled:!0,children:"Locked"}):e.jsx("button",{onClick:m,className:"flex w-full items-center justify-center rounded-xl border-b-4 border-yellow-200 bg-white p-3 uppercase text-yellow-400",children:"Practice +5 XP"})]})})},U=[140,95,70,95,140,185,210,185],Ke=({index:t,unitNumber:s,tilesLength:n})=>{if(t>=n-1)return U[0];const l=s%2===1?U:[...U.slice(4),...U.slice(0,4)];return l[t%l.length]??U[0]},Xe=({course:t,onUnitSelect:s,onLessonSelect:n})=>{const[l,r]=c.useState({}),o=c.useMemo(()=>Pe(t?.units||[]),[t]);return c.useEffect(()=>{let i=!0;return(async()=>{try{if(!t?.id)return;const d=(await B.getCourseProgress(t.id))?.data||[],a={};d.forEach(x=>{const h=Array.isArray(x?.lessons)?x.lessons:[];a[x.id]=h.filter(u=>!!u?.completed).length}),i&&r(a)}catch{i&&r({})}})(),()=>{i=!1}},[t?.id]),c.useEffect(()=>{if(typeof window>"u")return;const i=new URL(window.location.href);i.searchParams.get("refresh")==="1"&&(async()=>{try{if(!t?.id)return;const a=(await B.getCourseProgress(t.id))?.data||[],x={};a.forEach(h=>{const u=Array.isArray(h?.lessons)?h.lessons:[];x[h.id]=u.filter(y=>!!y?.completed).length}),r(x)}catch{}finally{i.searchParams.delete("refresh"),window.history.replaceState({},"",i.toString())}})()},[t?.id]),e.jsx("div",{className:"flex max-w-5xl grow flex-col",children:o.map((i,m)=>{const d=m>0?o[m-1]:null,a=d&&d.lessons?.length||0,x=d&&l[d.id]||0,h=d?x>=a&&a>0:!0;return e.jsx(De,{unit:i,prevUnitCompleted:h,completedCount:l[i.id]||0,onStartLesson:(u,y)=>{s&&s({id:y.id,title:y.title,order:y.order,...y}),n&&n(u,{id:y.id,title:y.title,order:y.order,...y})}},i.unitNumber)})})},We=({filled:t})=>e.jsx("svg",{width:"28",height:"23",viewBox:"0 0 28 23",fill:"none",children:e.jsx("path",{d:"M14 22s-6.716-3.725-10.5-7.5C.69 11.69.69 7.31 3.5 4.5 6.31 1.69 10.69 1.69 13.5 4.5L14 5l.5-.5c2.81-2.81 7.19-2.81 10 0 2.81 2.81 2.81 7.19 0 10C20.716 18.275 14 22 14 22z",fill:t?"#ff4b4b":"none",stroke:"#ff4b4b",strokeWidth:"2"})}),Ze=({value:t,total:s,onExit:n,hearts:l})=>{const r=s===0?0:t/s;return e.jsxs("header",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"text-gray-400",onClick:n,"aria-label":"Exit lesson",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2"})})}),e.jsx("div",{className:"h-4 grow rounded-full bg-gray-200",role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":r,children:e.jsx("div",{className:"h-full rounded-full bg-green-500 transition-all duration-700 "+(t>0?"px-2 pt-1 ":""),style:{width:`${r*100}%`},children:e.jsx("div",{className:"h-[5px] w-full rounded-full bg-green-400"})})}),[1,2,3,4,5].map(o=>e.jsx(We,{filled:l===null?!1:o<=l},o))]})},qe=({isAnswerSelected:t,isAnswerCorrect:s,correctAnswerShown:n,correctAnswer:l,onCheckAnswer:r,onFinish:o,onSkip:i,award:m})=>e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"border-gray-200 sm:border-t-2 sm:p-10",children:e.jsxs("div",{className:"mx-auto flex max-w-5xl sm:justify-between",children:[e.jsx("button",{className:"hidden rounded-2xl border-2 border-b-4 border-gray-200 bg-white p-3 font-bold uppercase text-gray-400 transition hover:border-gray-300 hover:bg-gray-200 sm:block sm:min-w-[150px] sm:max-w-fit",onClick:i,children:"Skip"}),t?e.jsx("button",{onClick:r,className:"flex w-full items-center justify-center rounded-2xl border-b-4 border-green-600 bg-green-500 p-3 font-bold uppercase text-white transition hover:brightness-105 sm:min-w-[150px] sm:max-w-fit",children:"Check"}):e.jsx("button",{className:"grow rounded-2xl bg-gray-200 p-3 font-bold uppercase text-gray-400 sm:min-w-[150px] sm:max-w-fit sm:grow-0",disabled:!0,children:"Check"})]})}),e.jsx("div",{className:n?s?"fixed bottom-0 left-0 right-0 bg-lime-100 font-bold text-green-600 transition-all":"fixed bottom-0 left-0 right-0 bg-red-100 font-bold text-red-500 transition-all":"fixed -bottom-52 left-0 right-0",children:e.jsxs("div",{className:"flex max-w-5xl flex-col gap-4 p-5 sm:mx-auto sm:flex-row sm:items-center sm:justify-between sm:p-10 sm:py-14",children:[s?e.jsxs("div",{className:"mb-2 flex flex-col gap-5 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"hidden rounded-full bg-white p-5 text-green-500 sm:block",children:"✓"}),e.jsxs("div",{className:"text-2xl flex items-center gap-3",children:["Good job!",m?.practice&&m?.xp>0&&e.jsxs("span",{className:"inline-block rounded-full bg-purple-100 px-3 py-1 text-xs font-semibold text-purple-600",children:["Practice +",m.xp," XP"]})]})]}):e.jsxs("div",{className:"mb-2 flex flex-col gap-5 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"hidden rounded-full bg-white p-5 text-red-500 sm:block",children:"✕"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"text-2xl",children:"Correct solution:"})," ",e.jsx("div",{className:"text-sm font-normal",children:l})]})]}),e.jsx("button",{className:"flex w-full items-center justify-center rounded-2xl border-b-4 border-green-600 bg-green-500 p-3 font-bold uppercase text-white transition hover:brightness-105 sm:min-w-[150px] sm:max-w-fit",onClick:o,children:"Continue"})]})})]}),Qe=({question:t,selected:s,setSelected:n})=>{const l=t.options||[],r=l.length,o=r<=2?"sm:grid-cols-2":r===3?"sm:grid-cols-3":"sm:grid-cols-4",i=(r<=2,"grid-cols-2");return e.jsxs("section",{className:"flex max-w-2xl grow flex-col gap-5 self-center sm:items-center sm:justify-center sm:gap-24 sm:px-5",children:[e.jsx("h1",{className:"w-full text-center text-2xl font-bold sm:text-3xl",children:t.text}),t.image_url?e.jsx("div",{className:"w-full flex items-center justify-center",children:e.jsx("img",{src:t.image_url,alt:"Question",className:"max-h-48 w-auto object-contain",loading:"lazy",onError:m=>{m.currentTarget.style.display="none"}})}):null,e.jsx("div",{className:`grid ${i} ${o} gap-2`,role:"radiogroup",children:l.map((m,d)=>e.jsxs("div",{className:d===s?"cursor-pointer rounded-xl border-2 border-b-4 border-blue-300 bg-blue-100 p-4 text-blue-400":"cursor-pointer rounded-xl border-2 border-b-4 border-gray-200 p-4 hover:bg-gray-100",role:"radio","aria-checked":d===s,tabIndex:0,onClick:()=>n(d),children:[m.image_url?e.jsx("img",{src:m.image_url,alt:"",className:"mb-2 h-24 w-full object-contain",loading:"lazy",onError:a=>{a.currentTarget.style.display="none"}}):null,e.jsx("h2",{className:"text-center",children:m.text})]},m.id))})]})},Ge=({question:t,selectedIndices:s,setSelectedIndices:n})=>{const l=(t.options||[]).map(r=>r.text);return(t.options||[]).map((r,o)=>r.is_correct?o:-1).filter(r=>r!==-1),e.jsxs("section",{className:"flex max-w-2xl grow flex-col gap-5 self-center sm:items-center sm:justify-center sm:gap-24",children:[e.jsx("h1",{className:"mb-2 text-2xl font-bold sm:text-3xl",children:"Write this in English"}),t.image_url?e.jsx("div",{className:"w-full flex items-center justify-center",children:e.jsx("img",{src:t.image_url,alt:"Question",className:"max-h-48 w-auto object-contain",loading:"lazy",onError:r=>{r.currentTarget.style.display="none"}})}):null,t.text?e.jsx("p",{className:"text-center text-gray-700",children:t.text}):null,e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex min-h-[60px] flex-wrap gap-1 border-b-2 border-t-2 border-gray-200 py-1",children:s.map(r=>e.jsx("button",{className:"rounded-2xl border-2 border-b-4 border-gray-200 p-2 text-gray-700",onClick:()=>n(o=>o.filter(i=>i!==r)),children:l[r]},r))}),e.jsx("div",{className:"mt-2 flex flex-wrap justify-center gap-1",children:l.map((r,o)=>e.jsx("button",{className:s.includes(o)?"rounded-2xl border-2 border-b-4 border-gray-200 bg-gray-200 p-2 text-gray-200":"rounded-2xl border-2 border-b-4 border-gray-200 p-2 text-gray-700",disabled:s.includes(o),onClick:()=>n(i=>i.includes(o)?i:[...i,o]),children:r},o))})]})]})},Ye=({question:t,onAllMatched:s,onMismatch:n})=>{const l=Array.isArray(t?.meta?.pairs)?t.meta.pairs:[],r=c.useMemo(()=>l.map((g,j)=>({id:"L"+j,value:g.left,image:g.left_image||null,pairIndex:j})),[l]),o=c.useMemo(()=>l.map((g,j)=>({id:"R"+j,value:g.right,image:g.right_image||null,pairIndex:j})),[l]),[i,m]=c.useState(0),[d,a]=c.useState(null),[x,h]=c.useState(null),[u,y]=c.useState(new Set),[L,f]=c.useState(null),k=c.useMemo(()=>{const g=r.filter(b=>u.has(b.id)),S=[...r.filter(b=>!u.has(b.id))].sort(()=>Math.random()-.5);return[...g,...S]},[r,i,u]),A=c.useMemo(()=>{const g=o.filter(b=>u.has(b.id)),S=[...o.filter(b=>!u.has(b.id))].sort(()=>Math.random()-.5);return[...g,...S]},[o,i,u]);c.useEffect(()=>{l.length>0&&u.size>=l.length*2&&s?.()},[u,l.length,s]),c.useEffect(()=>{a(null),h(null),y(new Set),f(null),m(0)},[t?.id]);const M=(g,j)=>{u.has(j.id)||(g==="left"?(a(j.id===d?null:j.id),f(null)):(h(j.id===x?null:j.id),f(null)))};c.useEffect(()=>{if(d&&x){const g=r.find(C=>C.id===d),j=o.find(C=>C.id===x);if(g&&j)if(g.pairIndex===j.pairIndex)y(C=>new Set([...C,g.id,j.id])),f("ok");else{f("bad");try{n&&n()}catch{}}const S=g&&j&&g.pairIndex===j.pairIndex,b=setTimeout(()=>{a(null),h(null),S||f(null)},S?250:650);return()=>clearTimeout(b)}},[d,x,r,o]);const I=(g,j)=>{const S=(j==="left"?d:x)===g.id,b=u.has(g.id),C="rounded-xl border-2 border-b-4 px-3 py-3 text-center cursor-pointer transition select-none text-sm sm:text-base flex flex-col items-center gap-2";let $=C+" bg-white border-gray-200 hover:bg-gray-100";const _=L==="bad"&&(g.id===d||g.id===x);return b?$=C+" bg-green-100 border-green-300 text-green-700":_?$=C+" bg-red-100 border-red-300 text-red-600":S&&($=C+" bg-blue-100 border-blue-300 text-blue-600"),e.jsxs(H.div,{layout:!0,className:$+(b?" animate-pulse":""),onClick:()=>M(j,g),role:"button","aria-pressed":S,initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},whileTap:{scale:.95},children:[g.image&&e.jsx("img",{src:g.image,alt:g.value||"pair image",className:"max-h-16 w-auto object-contain",loading:"lazy",onError:D=>{D.currentTarget.style.display="none"}}),g.value&&e.jsx("span",{className:"whitespace-pre-wrap text-center leading-snug",children:g.value}),!g.value&&!g.image&&e.jsx("span",{className:"text-gray-400",children:"(empty)"})]},g.id)};return e.jsxs("section",{className:"flex max-w-2xl grow flex-col gap-5 self-center sm:items-center sm:justify-center sm:gap-12 sm:px-4",children:[e.jsx("div",{className:"flex w-full items-center justify-between gap-4",children:e.jsx("h1",{className:"flex-1 text-center text-2xl font-bold sm:text-3xl",children:t?.question||"Find the matching pairs"})}),e.jsxs("div",{className:"flex w-full flex-col gap-4 sm:flex-row sm:items-start sm:justify-center relative",children:[!s&&null,e.jsx("div",{className:"flex w-full flex-col gap-2",children:k.map(g=>I(g,"left"))}),e.jsx("div",{className:"flex w-full flex-col gap-2",children:A.map(g=>I(g,"right"))}),e.jsxs("div",{className:"absolute -top-8 left-0 text-xs font-semibold text-gray-500 sm:static sm:order-first sm:w-full sm:text-center",children:["Залишилось пар: ",Math.max(0,l.length-u.size/2)," / ",l.length]})]}),e.jsxs("div",{className:"flex w-full justify-center gap-4",children:[e.jsx("button",{type:"button",className:"rounded-full bg-gray-200 px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-300 disabled:opacity-40",disabled:l.length===0||u.size>=l.length*2,onClick:()=>m(g=>g+1),children:"Перетасувати"}),e.jsx("div",{className:"text-xs text-gray-500 flex items-center",children:l.length>0?`${u.size/2}/${l.length} співпало`:"Немає пар"})]})]})},Je=()=>{if(document.getElementById("confetti-keyframes"))return;const t=document.createElement("style");t.id="confetti-keyframes",t.textContent="@keyframes confetti-pop { 0%{transform:translate(0,0) scale(0.6) rotate(0deg); opacity:1} 80%{opacity:1} 100%{transform:translate(var(--dx), var(--dy)) scale(1) rotate(360deg); opacity:0} }",document.head.appendChild(t)},et=(t=36)=>{Je();const s=["#f97316","#f59e0b","#10b981","#3b82f6","#a855f7","#ef4444"],n=document.createElement("div");n.style.position="fixed",n.style.inset="0",n.style.pointerEvents="none",n.style.zIndex="9999",document.body.appendChild(n);const{innerWidth:l,innerHeight:r}=window,o=l/2,i=r/4;for(let m=0;m<t;m++){const d=document.createElement("span"),a=Math.random()*8+6,x=(Math.random()-.5)*l*.9,h=Math.random()*r*.9+r*.1;d.style.position="absolute",d.style.left=`${o}px`,d.style.top=`${i}px`,d.style.width=`${a}px`,d.style.height=`${a*.6}px`,d.style.borderRadius="2px",d.style.transform="translate(-50%, -50%)",d.style.backgroundColor=s[Math.floor(Math.random()*s.length)],d.style.setProperty("--dx",`${x}px`),d.style.setProperty("--dy",`${h}px`),d.style.animation=`confetti-pop ${700+Math.random()*500}ms ease-out forwards`,n.appendChild(d)}setTimeout(()=>n.remove(),1600)},re=(t=0,s=800)=>{const[n,l]=c.useState(0);return c.useEffect(()=>{const r=performance.now();let o;const i=m=>{const d=Math.min(1,(m-r)/s);l(Math.round(d*t)),d<1&&(o=requestAnimationFrame(i))};return o=requestAnimationFrame(i),()=>cancelAnimationFrame(o)},[t,s]),n},tt=({correct:t,total:s,onExit:n,displayXp:l,accuracyPercent:r})=>{const[o,i]=c.useState(!1),m=re(Math.max(0,Number(l)||0),900),d=re(Math.max(0,Math.min(100,r??Math.round(t/Math.max(s,1)*100))),900);return c.useEffect(()=>{o||(i(!0),et(40))},[o]),e.jsxs("div",{className:"flex min-h-screen flex-col gap-5",children:[e.jsxs("div",{className:"flex grow flex-col items-center justify-center gap-8 font-bold",children:[e.jsx(H.h1,{className:"text-center text-3xl text-yellow-400",initial:{scale:.6,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:180,damping:12},children:"Lesson Complete!"}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-5",children:[e.jsxs(H.div,{className:"min-w-[140px] rounded-xl border-2 border-yellow-400 bg-yellow-400",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.05},children:[e.jsx("h2",{className:"py-1 text-center text-white",children:"Total XP"}),e.jsx("div",{className:"flex justify-center rounded-xl bg-white py-5 text-3xl text-yellow-400",children:m})]}),e.jsxs(H.div,{className:"min-w-[140px] rounded-xl border-2 border-green-400 bg-green-400",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.15},children:[e.jsx("h2",{className:"py-1 text-center text-white",children:"Accuracy"}),e.jsxs("div",{className:"flex justify-center rounded-xl bg-white py-5 text-3xl text-green-400",children:[d,"%"]})]})]})]}),e.jsx("section",{className:"border-gray-200 sm:border-t-2 sm:p-10",children:e.jsxs("div",{className:"mx-auto flex max-w-5xl sm:justify-between",children:[e.jsx(H.button,{className:"hidden rounded-2xl border-2 border-b-4 border-gray-200 bg-white p-3 font-bold uppercase text-gray-400 transition hover:border-gray-300 hover:bg-gray-200 sm:block sm:min-w-[150px] sm:max-w-fit",onClick:n,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:"Review lesson"}),e.jsx(H.button,{className:"flex w-full items-center justify-center rounded-2xl border-b-4 border-green-600 bg-green-500 p-3 font-bold uppercase text-white transition hover:brightness-105 sm:min-w-[150px] sm:max-w-fit",onClick:n,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},children:"Continue"})]})})]})},st=({courseId:t,unitId:s,lessonId:n,onExit:l})=>{const r=ge(),[o,i]=c.useState(!0),[m,d]=c.useState(null),[a,x]=c.useState([]),[h,u]=c.useState(0),[y,L]=c.useState(null),[f,k]=c.useState([]),[A,M]=c.useState(!1),[I,g]=c.useState(!1),[j,S]=c.useState(0),[b,C]=c.useState(0),[$,_]=c.useState(null),[D,T]=c.useState(!1),[Q,V]=c.useState(""),[X,G]=c.useState(!1),[ne,Y]=c.useState(null),[J,le]=c.useState([]),[ae,oe]=c.useState(0);c.useEffect(()=>{let p=!0;return(async()=>{try{i(!0);const v=await q.getQuestions(t,s,n),w=Array.isArray(v.data)?v.data:v.data?.data||[];p&&x(w);try{const P=await B.getUserProgress(),E=P?.data?.hearts??P?.hearts??null;_(typeof E=="number"?E:null),(E??0)<=0&&T(!0)}catch{}}catch{d("Failed to load questions."),r?.error?.("Не вдалося завантажити питання.")}finally{i(!1)}})(),()=>{p=!1}},[t,s,n]),c.useEffect(()=>{L(null),k([]),M(!1)},[h]),c.useEffect(()=>{j+b>=a.length&&a.length>0&&G(!0)},[j,b,a.length]),c.useEffect(()=>{X&&(async()=>{try{const p=await B.completeLesson(n,j,a.length),v=p?.data??p,w=v?.awarded_xp??null;v?.lesson_completed===!0&&w!=null?(Y(w),r?.success?.(`Урок завершено: +${w} XP`)):(Y(0),r?.info?.("Урок не складено. Бонус XP не нараховано."))}catch{}})()},[X,n,j,a.length]);const N=a[h],ie=a.length,O=N&&(N.options||[]).filter(p=>p.is_correct).length===1&&N.type!=="match",R=!!N&&(N.type==="match"||N.meta&&Array.isArray(N.meta.pairs)),W=R?Array.isArray(N.meta?.pairs)?N.meta.pairs:[]:[],[ee,ce]=c.useState(!1),de=async()=>{let p=!1;if(R)p=ee&&W.length>0;else if(O)p=N.options?.[y]?.is_correct===!0;else{const v=N.options.map((w,P)=>w.is_correct?P:-1).filter(w=>w!==-1);p=f.length===v.length&&f.every((w,P)=>w===v[P])}g(p),M(!0);try{const v=await B.updateChallengeProgress(N.id,p),w=v?.data?.awarded_xp??v?.awarded_xp??0,P=v?.data?.practice??v?.practice??!1;if(le(E=>{const z=[...E];return z[h]={xp:w,practice:P},z}),!p){const E=await B.reduceHearts(N.id),z=E?.data?.hearts??E?.hearts;typeof z=="number"?(_(z),z<=0&&T(!0)):(_(K=>typeof K=="number"?Math.max(K-1,0):K),T(K=>!0))}p?S(E=>E+1):C(E=>E+1)}catch{}},xe=()=>{h<a.length-1?u(p=>p+1):(M(!1),u(h),G(!0))};if(X){const v=J.reduce((E,z)=>E+(z?.xp||0),0)+(ne??0),w=j+b+ae,P=w>0?Math.round(j/w*100):0;return e.jsx(tt,{correct:j,total:a.length,displayXp:v,onExit:l,accuracyPercent:P})}let F="";N&&(R?F=W.map(p=>`${p.left} – ${p.right}`).join(", "):O?F=N.options?.find(p=>p.is_correct)?.text||"":F=(N.options||[]).filter(p=>p.is_correct).map(p=>p.text).join(" "));const me=R?ee&&W.length>0:O?y!==null:f.length>0;return o?e.jsx("div",{children:"Loading lesson..."}):m?e.jsx("div",{className:"text-red-500",children:m}):a.length?e.jsxs("div",{className:"flex min-h-screen flex-col gap-5",children:[e.jsx(Ze,{value:j+b,total:ie,onExit:l,hearts:$}),D&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white p-6 text-center shadow-xl",children:[e.jsx("div",{className:"mb-2 text-2xl font-bold text-rose-600",children:"Немає сердець"}),e.jsx("p",{className:"mb-4 text-gray-700",children:"Поповни серця, щоб продовжити урок."}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:l,className:"rounded-full bg-gray-200 px-4 py-2 font-semibold text-gray-700 hover:bg-gray-300",children:"Вийти"}),e.jsx("button",{onClick:async()=>{V("");try{const p=await B.refillHearts(),v=p?.data?.hearts??p?.hearts;if(typeof v=="number"&&(_(v),v>0)){T(!1),V(""),r?.success?.("Життя відновлено!");return}V("Не вдалося поповнити серця."),r?.error?.("Не вдалося поповнити серця.")}catch(p){const v=p?.response?.status,w=p?.response?.data?.message||"";v===400&&w.includes("Not enough points")?(V("Недостатньо очок для поповнення."),r?.error?.("Недостатньо очок для поповнення.")):v===400&&w.includes("Hearts are already full")?(V("Серця вже повні."),r?.info?.("Серця вже повні.")):(V("Сталася помилка. Спробуй ще раз."),r?.error?.("Сталася помилка. Спробуй ще раз."))}},className:"rounded-full bg-rose-500 px-4 py-2 font-semibold text-white hover:bg-rose-600",children:"Поповнити"})]}),Q&&e.jsx("div",{className:"mt-3 text-sm text-rose-600",children:Q})]})}),!D&&R?e.jsx(Ye,{question:N,onAllMatched:()=>ce(!0),onMismatch:()=>{(async()=>{try{const p=await B.reduceHearts(N.id),v=p?.data?.hearts??p?.hearts;typeof v=="number"?(_(v),v<=0&&T(!0)):(_(w=>typeof w=="number"?Math.max(w-1,0):w),T(w=>!0))}catch{_(v=>{const w=typeof v=="number"?Math.max(v-1,0):0;return w<=0&&T(!0),w})}oe(p=>p+1)})()}}):!D&&O?e.jsx(Qe,{question:N,selected:y,setSelected:L}):D?e.jsx("div",{className:"flex grow items-center justify-center text-gray-500",children:"Серця закінчилися"}):e.jsx(Ge,{question:N,selectedIndices:f,setSelectedIndices:k}),e.jsx(qe,{isAnswerSelected:me,isAnswerCorrect:I,correctAnswerShown:A,correctAnswer:F,onCheckAnswer:D?()=>{}:de,onFinish:xe,onSkip:()=>{g(!1),M(!0)},award:J[h]})]}):e.jsx("div",{children:"No questions available for this lesson."})},mt=({auth:t,course:s})=>{const[n,l]=c.useState(null),[r,o]=c.useState(null),[i,m]=c.useState(!0),[d,a]=c.useState(!1),x=c.useMemo(()=>s?.units?s.units.map((f,k)=>{const A=(f.lessons||[]).map(b=>{const C=b.title||b.name||`Lesson ${b.id}`,$=!!(b.completed||b.is_completed||b.passed||b.completed_at||b.status==="completed");return{name:C,completed:$,stars:b.stars||0,character:b.icon||b.emoji||($?"📗":"📘")}}),M=A.some(b=>b.completed),I=f.unlocked!==void 0?!!f.unlocked:k===0||M,g=A.length>0&&A.every(b=>b.completed),j=I&&!g&&!s.units.slice(0,k).some((b,C)=>{const $=(b.lessons||[]).map(T=>!!(T.completed||T.is_completed||T.passed||T.completed_at||T.status==="completed")),_=$.length>0&&$.every(Boolean);return(b.unlocked!==void 0?!!b.unlocked:C===0||$.some(Boolean))&&!_}),S=["purple","blue","teal"];return{title:f.title||f.name||`Unit ${k+1}`,theme:S[k%S.length],icon:f.icon||f.emoji||"📦",lessons:A,unlocked:I,current:j}}):[],[s]);c.useEffect(()=>{if(typeof window>"u")return;if(new URL(window.location.href).searchParams.get("start")==="1"&&s?.units?.length&&!n&&!r){const A=s.units.find(M=>Array.isArray(M.lessons)&&M.lessons.length>0)||s.units[0];l(A),A?.lessons?.length&&o(A.lessons[0])}},[s,n,r]);const h=f=>{l(f),o(null)},u=(f,k)=>{k&&l(k),o(f)};c.useEffect(()=>{if(!(typeof document>"u")&&r){const f=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=f}}},[r]);const y=()=>r?e.jsx("div",{id:"lesson-overlay",className:"fixed inset-0 z-[9999] bg-white overflow-auto",children:e.jsx("div",{id:"lesson-container",className:"mx-auto max-w-5xl min-h-screen flex flex-col px-4 py-6 sm:px-6",children:e.jsx(st,{courseId:s.id,unitId:n.id,lessonId:r.id,onExit:()=>{if(o(null),typeof window<"u"){const f=new URL(window.location.href);f.searchParams.set("refresh","1"),window.history.replaceState({},"",f.toString())}}})})}):d?e.jsx("div",{className:"w-full",children:e.jsx(je,{units:x})}):i?e.jsx("div",{className:"w-full",children:e.jsx("div",{id:"learn-tree",className:"min-w-0 w-full",children:e.jsx(Xe,{course:s,onUnitSelect:h,onLessonSelect:u})})}):n?e.jsx(Ce,{courseId:s.id,unitId:n.id,onLessonSelect:u}):e.jsx(Ne,{courseId:s.id,initialCourse:s,onUnitSelect:h,onLessonSelect:u});return(()=>{const f=[{name:"Courses",href:"/courses",current:!n&&!r}];return s&&f.push({name:s.title,href:`/courses/${s.id}`,current:!n&&!r}),n&&f.push({name:n.title,href:"#",current:!!n&&!r}),r&&f.push({name:r.title,href:"#",current:!0}),f})(),e.jsxs(ue,{right:r?null:e.jsx(pe,{course:s,hearts:t?.user?.hearts??void 0,points:t?.user?.points??t?.user?.xp??void 0,otherCourses:(t?.user?.courses||[]).filter(f=>f.id!==s.id)}),centerMaxClass:"xl:max-w-2xl",children:[e.jsx(he,{title:s.title}),r?y():e.jsx("div",{id:"course-page",className:"w-full",children:e.jsxs("div",{id:"course-container",className:`mx-auto w-full ${i?"":"max-w-5xl"}`,children:[e.jsxs("div",{id:"course-header",className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:s.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Path"}),e.jsx("button",{className:`rounded-2xl border-2 border-b-4 px-3 py-1 text-sm font-bold transition ${d?"border-indigo-600 bg-indigo-500 text-white":"border-gray-300 bg-white text-gray-500"}`,onClick:()=>a(f=>!f),children:d?"ON":"OFF"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Tree"}),e.jsx("button",{className:`rounded-2xl border-2 border-b-4 px-3 py-1 text-sm font-bold transition ${i&&!d?"border-green-600 bg-green-500 text-white":"border-gray-300 bg-white text-gray-500"}`,onClick:()=>m(f=>!f),disabled:d,children:i&&!d?"ON":"OFF"})]})]})]}),y()]})})]})};export{mt as default};
