import{j as r,a as n,s as i,b as d,c as S,r as c,H as _,L as I,d as E}from"./app-CB6H9fcf.js";import{T as w,I as x}from"./TextInput-BLtfRUkU.js";import{I as b}from"./InputLabel-WLmqtfT-.js";import{P as F}from"./LegacyButtons-DnvdfYhJ.js";import{G as P}from"./GuestLayout-_Izhwini.js";import"./button-2bCJMJSP.js";import"./ApplicationLogo-rwhi1fvF.js";function A({className:s="",...e}){return r.jsx("input",{...e,type:"checkbox",className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500 "+s})}const y={register:async s=>{try{await d();const e=await n.post("/auth/register",s);return e.data.success&&e.data.data.access_token&&i(e.data.data.access_token),e.data}catch(e){throw console.error("Registration error:",e),e}},login:async s=>{try{await d();const e=await n.post("/auth/login",s);return e.data.success&&e.data.data.access_token&&i(e.data.data.access_token),e.data}catch(e){throw console.error("Login error:",e),e}},webLogin:async s=>{try{return await d(),await S.post("/login",{email:s.email,password:s.password,remember:!!s.remember},{withCredentials:!0}),{success:!0}}catch(e){throw console.error("Web session login error:",e),e}},logout:async()=>{try{const s=await n.post("/auth/logout");return i(null),s.data}catch(s){throw console.error("Logout error:",s),i(null),s}},getCurrentUser:async()=>{try{return(await n.get("/auth/me")).data}catch(s){throw console.error("Get current user error:",s),s}},isAuthenticated:()=>localStorage.getItem("auth_token")!==null};function U({status:s,canResetPassword:e}){const[a,j]=c.useState({email:"",password:"",remember:!1}),[p,g]=c.useState({}),[k,h]=c.useState(!1),[f,l]=c.useState(s),m=u=>{const{name:t,value:o,checked:N}=u.target,L=t==="remember"?N:o;j(C=>({...C,[t]:L}))},v=async u=>{u.preventDefault(),h(!0),g({});try{if((await y.login({email:a.email,password:a.password})).success){try{await y.webLogin({email:a.email,password:a.password,remember:a.remember})}catch{}l("Успішний вхід. Перенаправлення..."),E.visit("/dashboard")}}catch(t){if(t.response&&t.response.data){const o=t.response.data;o.message&&l(o.message),o.errors&&g(o.errors)}else l("Помилка входу. Спробуйте ще раз.")}finally{h(!1)}};return r.jsxs(P,{children:[r.jsx(_,{title:"Log in"}),f&&r.jsx("div",{className:"mb-4 text-sm font-medium text-green-600",children:f}),r.jsxs("form",{onSubmit:v,children:[r.jsxs("div",{children:[r.jsx(b,{htmlFor:"email",value:"Email"}),r.jsx(w,{id:"email",type:"email",name:"email",value:a.email,className:"mt-1 block w-full",autoComplete:"username",isFocused:!0,onChange:m}),r.jsx(x,{message:p.email,className:"mt-2"})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx(b,{htmlFor:"password",value:"Password"}),r.jsx(w,{id:"password",type:"password",name:"password",value:a.password,className:"mt-1 block w-full",autoComplete:"current-password",onChange:m}),r.jsx(x,{message:p.password,className:"mt-2"})]}),r.jsx("div",{className:"mt-4 block",children:r.jsxs("label",{className:"flex items-center",children:[r.jsx(A,{name:"remember",checked:a.remember,onChange:m}),r.jsx("span",{className:"ms-2 text-sm text-gray-600",children:"Remember me"})]})}),r.jsxs("div",{className:"mt-4 flex items-center justify-end",children:[e&&r.jsx(I,{href:route("password.request"),className:"rounded-md text-sm text-gray-600 underline hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:"Forgot your password?"}),r.jsx(F,{className:"ms-4",disabled:k,children:"Log in"})]})]})]})}export{U as default};
